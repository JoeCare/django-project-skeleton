FROM nginx:1.17

COPY bin/set_timezone.sh /docker-bin/
COPY nginx/entrypoint_nginx.sh /docker-bin/
COPY nginx/nginx.conf.template /docker-bin/

ARG DPS_SERVER_NAME=localhost
ENV DPS_SERVER_NAME ${DPS_SERVER_NAME}

ARG DPS_STATIC_URL=/static/
ENV DPS_STATIC_URL ${DPS_STATIC_URL}

ARG DPS_UPSTREAM_KEEPALIVE_TIMEOUT=60
ENV DPS_UPSTREAM_KEEPALIVE_TIMEOUT ${DPS_UPSTREAM_KEEPALIVE_TIMEOUT}

ARG DPS_NGINX_UPSTREAM_KEEPALIVE_NUM_CONN=5
ENV DPS_NGINX_UPSTREAM_KEEPALIVE_NUM_CONN ${DPS_NGINX_UPSTREAM_KEEPALIVE_NUM_CONN}

ARG DPS_NGINX_UPSTREAM_KEEPALIVE_NUM_REQ=100
ENV DPS_NGINX_UPSTREAM_KEEPALIVE_NUM_REQ ${DPS_NGINX_UPSTREAM_KEEPALIVE_NUM_REQ}

ARG DPS_NGINX_SERVER_KEEPALIVE=60
ENV DPS_NGINX_SERVER_KEEPALIVE ${DPS_NGINX_SERVER_KEEPALIVE}

ARG DPS_NGINX_SERVER_TOKENS=off
ENV DPS_NGINX_SERVER_TOKENS ${DPS_NGINX_SERVER_TOKENS}

ARG DPS_NGINX_GZIP_ACTIVATION=on
ENV DPS_NGINX_GZIP_ACTIVATION ${DPS_NGINX_GZIP_ACTIVATION}

ARG DPS_NGINX_GZIP_COMPRESSION=4
ENV DPS_NGINX_GZIP_COMPRESSION ${DPS_NGINX_GZIP_COMPRESSION}

ARG DPS_NGINX_GZIP_MIN_LENGTH=500
ENV DPS_NGINX_GZIP_MIN_LENGTH ${DPS_NGINX_GZIP_MIN_LENGTH}

ARG DPS_NGINX_GZIP_TYPES="text/css font/woff"
ENV DPS_NGINX_GZIP_TYPES ${DPS_NGINX_GZIP_TYPES}

ENTRYPOINT ["/docker-bin/entrypoint_nginx.sh"]
CMD ["nginx", "-g", "daemon off;"]
