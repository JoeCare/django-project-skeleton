version: '3.5'

services:
    django:
        build:
            context: ../../
            dockerfile: deploy/Docker/django/Dockerfile
        # providing the build and the image directive automatically tags the image
        # automatic tagging is performed with environment variables provided
        # through the Makefile and results in a tag with either a git commit hash
        # or a datetime stamp (see Makefile.deployment)
        image: ${DPS_BUILD_NAME_PREFIX}/django:${DPS_BUILD_ID}
        env_file:
            ./env.production
        expose:
            - "8000"
        volumes:
            - static-files:/webapp/run/static
    nginx:
        build:
            context: ./
            dockerfile: nginx/Dockerfile
        # providing the build and the image directive automatically tags the image
        # automatic tagging is performed with environment variables provided
        # through the Makefile and results in a tag with either a git commit hash
        # or a datetime stamp (see Makefile.deployment)
        image: ${DPS_BUILD_NAME_PREFIX}/nginx:${DPS_BUILD_ID}
        env_file:
            ./env.production
        ports:
            - "80:80"
        volumes:
            - static-files:/var/www/django_files/static

volumes:
    static-files:
